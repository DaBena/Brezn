# üîê Brezn QR-Code System

Das Brezn QR-Code System erm√∂glicht es Netzwerk-Teilnehmern, sich einfach √ºber QR-Codes zu verbinden und dem dezentralen Netzwerk beizutreten.

## üìã √úbersicht

Das QR-Code-System besteht aus mehreren Komponenten:

- **QR-Code-Generierung**: Erstellt QR-Codes mit Peer-Informationen
- **QR-Code-Parsing**: Verarbeitet QR-Codes von anderen Peers
- **QR-Code-Validierung**: √úberpr√ºft die Integrit√§t der QR-Code-Daten
- **Web-Interface**: Benutzerfreundliche Oberfl√§che f√ºr alle QR-Code-Funktionen

## üèóÔ∏è Architektur

### Core-Komponenten

#### 1. QRCodeData-Struktur
```rust
pub struct QRCodeData {
    pub version: String,           // Version des QR-Code-Formats
    pub node_id: String,          // Eindeutige Node-ID
    pub public_key: String,       // √ñffentlicher Schl√ºssel f√ºr Verschl√ºsselung
    pub address: String,          // IP-Adresse des Peers
    pub port: u16,                // Port des Peers
    pub timestamp: u64,           // Zeitstempel der Erstellung
    pub capabilities: Vec<String>, // Verf√ºgbare Funktionen
    pub checksum: String,         // SHA256-Checksum f√ºr Validierung
}
```

#### 2. DiscoveryManager
Verwaltet die Peer-Discovery und QR-Code-Funktionalit√§t:

- `generate_qr_code()`: Generiert PNG-Format
- `generate_qr_code_svg()`: Generiert SVG-Format
- `generate_qr_code_image()`: Generiert PNG-Bytes
- `parse_qr_code()`: Parst QR-Code-Daten
- `validate_qr_data()`: Validiert QR-Code-Daten

### Web-Interface

#### Hauptseite: `/web/qr.html`
- Moderne, responsive Benutzeroberfl√§che
- Unterst√ºtzt verschiedene QR-Code-Formate (PNG, SVG, JSON)
- Datei-Upload f√ºr QR-Code-Verarbeitung
- Echtzeit-Statistiken und Validierung

#### Integration: `/web/index.html`
- Grundlegende QR-Code-Funktionalit√§t im Netzwerk-Tab
- Einfache Peer-Verbindung √ºber QR-Codes

## üöÄ Verwendung

### QR-Code generieren

1. **Web-Interface √∂ffnen**: Navigiere zu `/web/qr.html`
2. **Format ausw√§hlen**: W√§hle zwischen PNG, SVG, JSON oder allen Formaten
3. **Gr√∂√üe einstellen**: W√§hle die gew√ºnschte QR-Code-Gr√∂√üe
4. **Generieren**: Klicke auf "QR-Code generieren"
5. **Download**: Lade den QR-Code in verschiedenen Formaten herunter

### QR-Code verarbeiten

1. **QR-Code scannen**: Verwende eine QR-Code-Scanner-App
2. **Daten eingeben**: F√ºge QR-Code-Daten manuell ein
3. **Datei hochladen**: Lade ein QR-Code-Bild hoch
4. **Verarbeiten**: Klicke auf "QR-Code verarbeiten"
5. **Peer hinzuf√ºgen**: Der Peer wird automatisch zum Netzwerk hinzugef√ºgt

### QR-Code validieren

1. **Daten eingeben**: F√ºge QR-Code-Daten in das Validierungsfeld ein
2. **Validieren**: Klicke auf "Nur validieren"
3. **Ergebnis pr√ºfen**: √úberpr√ºfe die Validierungsergebnisse

## üîí Sicherheitsfeatures

### Checksum-Validierung
- SHA256-Hash √ºber alle Peer-Daten
- Verhindert Manipulation der QR-Code-Daten
- Automatische √úberpr√ºfung bei der Verarbeitung

### Zeitstempel-Validierung
- QR-Codes sind maximal 1 Stunde g√ºltig
- Verhindert Replay-Angriffe
- Automatische Bereinigung veralteter Daten

### Datenvalidierung
- √úberpr√ºfung aller Pflichtfelder
- Port-Bereichsvalidierung (1-65535)
- Version-Kompatibilit√§tspr√ºfung

## üìä API-Endpunkte

### QR-Code-Generierung
```
GET /api/network/qr
GET /api/network/qr-formats?size={size}
```

### QR-Code-Verarbeitung
```
POST /api/network/parse-qr
POST /api/network/parse-qr-advanced
POST /api/network/validate-qr
```

### Antwortformate

#### Erfolgreiche Generierung
```json
{
  "success": true,
  "qr_data": {
    "version": "1.0",
    "node_id": "node_123",
    "public_key": "pub_key_456",
    "address": "192.168.1.100",
    "port": 8080,
    "timestamp": 1640995200,
    "capabilities": ["posts", "config", "p2p"],
    "checksum": "abc123..."
  },
  "qr_code": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
}
```

#### Erweiterte Formate
```json
{
  "success": true,
  "qr_data": { ... },
  "formats": {
    "png_base64": "data:image/png;base64,...",
    "svg": "<svg>...</svg>",
    "raw_data": "QR-Code-Rohdaten",
    "json": "{...}"
  }
}
```

## üß™ Tests

Das System umfasst umfassende Tests:

```bash
# Alle Tests ausf√ºhren
cargo test

# Nur QR-Code-Tests
cargo test --test discovery

# Spezifische QR-Code-Tests
cargo test test_qr_code_generation
cargo test test_qr_code_validation
```

### Test-Coverage
- QR-Code-Generierung (PNG, SVG, JSON)
- QR-Code-Parsing und -Validierung
- Checksum-Berechnung und -Validierung
- Zeitstempel-Validierung
- Fehlerbehandlung und Edge Cases

## üîß Konfiguration

### DiscoveryConfig
```rust
pub struct DiscoveryConfig {
    pub enable_qr: bool,           // QR-Code-Funktionalit√§t aktivieren
    pub discovery_port: u16,       // Port f√ºr Peer-Discovery
    pub broadcast_address: String, // Broadcast-Adresse
    // ... weitere Einstellungen
}
```

### Umgebungsvariablen
```bash
BREZN_QR_ENABLED=true
BREZN_DISCOVERY_PORT=8888
BREZN_BROADCAST_ADDRESS=255.255.255.255:8888
```

## üì± Mobile Integration

Das QR-Code-System ist f√ºr mobile Ger√§te optimiert:

- **Responsive Design**: Funktioniert auf allen Bildschirmgr√∂√üen
- **Touch-Optimiert**: Gro√üe Buttons und Touch-freundliche Bedienelemente
- **Kamera-Integration**: Unterst√ºtzt native Kamera-Apps f√ºr QR-Code-Scanning
- **Offline-Funktionalit√§t**: Funktioniert auch ohne Internetverbindung

## üö® Fehlerbehandlung

### H√§ufige Fehler

1. **"QR code data is too old"**
   - L√∂sung: Generiere einen neuen QR-Code

2. **"QR code checksum validation failed"**
   - L√∂sung: √úberpr√ºfe die Integrit√§t der Daten

3. **"Invalid port number"**
   - L√∂sung: Stelle sicher, dass der Port zwischen 1-65535 liegt

4. **"Missing required fields"**
   - L√∂sung: √úberpr√ºfe alle Pflichtfelder

### Debugging

```bash
# Logs aktivieren
RUST_LOG=debug cargo run

# Spezifische QR-Code-Logs
RUST_LOG=brezn::discovery=debug cargo run
```

## üîÆ Zuk√ºnftige Erweiterungen

### Geplante Features
- **QR-Code-Batch-Verarbeitung**: Mehrere QR-Codes gleichzeitig verarbeiten
- **QR-Code-Templates**: Anpassbare QR-Code-Designs
- **QR-Code-Historie**: Verlauf aller generierten und verarbeiteten QR-Codes
- **QR-Code-Statistiken**: Detaillierte Analysen und Berichte
- **QR-Code-API**: RESTful API f√ºr externe Integrationen

### Technische Verbesserungen
- **Bessere Fehlerkorrektur**: Unterst√ºtzung f√ºr besch√§digte QR-Codes
- **Komprimierung**: Optimierte Datenkomprimierung f√ºr kleinere QR-Codes
- **Verschl√ºsselung**: Optionale Ende-zu-Ende-Verschl√ºsselung
- **Multi-Format**: Unterst√ºtzung f√ºr weitere QR-Code-Formate

## üìö Weitere Ressourcen

- [Brezn Hauptdokumentation](../README.md)
- [API-Referenz](../docs/API.md)
- [Netzwerk-Architektur](../docs/NETWORK.md)
- [Entwickler-Guide](../docs/DEVELOPER.md)

## ü§ù Beitragen

Das QR-Code-System ist ein Open-Source-Projekt. Beitr√§ge sind willkommen!

### Entwicklung
1. Fork das Repository
2. Erstelle einen Feature-Branch
3. Implementiere deine √Ñnderungen
4. Schreibe Tests
5. Erstelle einen Pull Request

### Feedback
- **Issues**: Melde Bugs oder Feature-Requests
- **Discussions**: Diskutiere Verbesserungen
- **Code Review**: √úberpr√ºfe Pull Requests

---

**Entwickelt f√ºr das Brezn-Projekt** ü•®
*Dezentrale Feed-App mit QR-Code-Integration*